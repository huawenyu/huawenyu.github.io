---
layout: post
title:  "sniffer"
date:   2014-02-16 13:31:01 +0800
categories: linux
tags: network
---

* content
{:toc}


# Install

    $ sudo apt-get install wireshark
    $ sudo apt-get install tshark

# tshark

## list interfaces

    > $ tshark -D
    > tshark: There are no interfaces on which a capture can be done

    $ sudo tshark -D            # et a list of the available network interfaces
    1. eth0
    2. nflog (Linux netfilter log (NFLOG) interface)
    3. any (Pseudo-device that captures on all interfaces)
    4. lo

## capture

    $ tshark -i eth0
    $ tshark -i eth0 -c 500 -w /tmp/http-test.pcap      # capture-to file
    $ tshark -r /tmp/http-test.pcap                     # view content of capture-file

## search from capture

    $ tshark -r nmap.pcap -R "ip.src == 2.x.yy.6 || ip.dst == 2.x.yy.6"
    $ tshark -q -r http.pcap -R http -z http,tree
    $ tshark -r nmap.pcap -R "icmp"

## filter

    $ tshark -w /tmp/dhcp.pcap -f "port 67 or port 68" -i eth1 -P
        -f "host 192.168.1.100 and (dst port 53 or 80)"
        -f "not broadcast and not multicast"
        -f "http.response.code == 404 && ip.addr == 192.168.10.1"
        -f "tcp.port == 25"
        -Y "ip.addr==192.168.1.1"
        -Y "tcp.port== 8800 and http.request"
        -Y "not arp or icmp"
        -d udp.port==8472,vxlan -r 1.cap "tcp.analysis.duplicate_ack_num==1"

    $ tshark -r /tmp/dhcp.pcap bootp.option.dhcp == 1
    $ tshark -r ~/dhcp.pcap -V frame.number == 1        # view content of a single packet

## formatting

    $ tshark -i eth2 -O  icmp
        -V verbose and display details about packets
        -O like the -V option, however this will show details of a specific protocol

## list of IP conversations

    $ tshark -r cap.pcap -z conv,ip


  [1]: https://sourceware.org/gdb/onlinedocs/gdb/gdbserver-man.html
  [2]: https://sourceware.org/gdb/wiki/FAQ
  [3]: https://blogs.oracle.com/ksplice/entry/8_gdb_tricks_you_should
  [4]: http://sourceware.org/gdb/onlinedocs/gdb/Continuing-and-Stepping.html
  [5]: https://github.com/huawenyu/neogdb.vim
